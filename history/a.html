<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <div class="timeline-container">
    <div class="timeline">
      <div class="timeline-line"></div>
      <!-- 时间轴事件将通过JavaScript动态生成 -->
    </div>
  </div>
</div>

<script>
  // 定义全局变量存储数据
  let mathHistoryData = [];

  // 从example.json加载数据
  async function loadMathHistoryData() {
    try {
      const response = await fetch('example.json');
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      const data = await response.json();
      return data;
    } catch (error) {
      console.error('Error loading math history data:', error);
      return [];
    }
  }

  // 初始化页面
  document.addEventListener('DOMContentLoaded', async function() {
    // 加载数据
    mathHistoryData = await loadMathHistoryData();

    // 按时间排序
    mathHistoryData.sort((a, b) => parseInt(a.time[0]) - parseInt(b.time[0]));

    // 渲染时间轴
    renderTimeline();

    // 设置事件监听器
    setupEventListeners();
  });

  // 渲染时间轴
  function renderTimeline(filter = "all") {
    const timeline = document.querySelector('.timeline');

    // 清除现有事件（除了时间线和时代标签）
    const existingEvents = timeline.querySelectorAll('.timeline-event, .timeline-marker');
    existingEvents.forEach(el => el.remove());

    // 计算同一时间点的事件数量，用于避免重叠
    const yearGroups = {};

    // 过滤事件
    const filteredEvents = mathHistoryData ?
            mathHistoryData.filter(event => {
              if (filter === "all") return true;
              return event.category === filter;
            }) : [];

    // 为每个事件创建DOM元素
    filteredEvents.forEach((event, index) => {
      const year = parseInt(event.time[0]);

      // 创建时间标记
      const marker = document.createElement('div');
      marker.className = 'timeline-marker';
      marker.style.top = `${event.position}%`;
      marker.setAttribute('data-year', year);
      timeline.appendChild(marker);

      // 创建事件卡片
      const eventElement = document.createElement('div');
      eventElement.className = `timeline-event ${event.side}`;
      eventElement.style.top = `${event.position}%`;
      eventElement.setAttribute('data-key', event.key);

      const color = categoryColors[event.category] || "#757575";
      eventElement.style.borderTop = `4px solid ${color}`;

      // 构建年份显示（处理公元前）
      let yearDisplay = year < 0 ? `${Math.abs(year)} BC` : `${year} AD`;

      // 事件内容
      eventElement.innerHTML = `
                    <div class="event-year" style="color: ${color}">${yearDisplay}</div>
                    <div class="event-title">${event.data.event}</div>
                    ${event.data.persons ? `<div class="event-persons">${Array.isArray(event.data.persons) ? event.data.persons.join(', ') : event.data.persons}</div>` : ''}
                    ${event.data.paper ? `<div class="event-paper">${event.data.paper}</div>` : ''}
                `;

      timeline.appendChild(eventElement);

      // 添加点击事件显示详情
      eventElement.addEventListener('click', () => showEventDetails(event));
    });
  }
</script>
</body>
</html>