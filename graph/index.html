<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DAG Viewer (Dark Characters)</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="controls">
  <input type="file" id="fileInput" accept=".json" />
  <button id="loadSample">Load Sample Data</button>
</div>

<div id="main-content"></div>

<script src="analyze_graph.js"></script>
<script src="render_svg.js"></script>
<script>
document.getElementById("fileInput").addEventListener("change", handleFile);
document.getElementById("loadSample").addEventListener("click", loadSampleData);

function handleFile(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = e => {
    const json = JSON.parse(e.target.result);
    renderDAG(json);
  };
  reader.readAsText(file);
}

function loadSampleData() {
  // Sample DAG data for demonstration - using the correct format expected by render_svg.js
  const sampleData = {
    "A": {
      "key": "A",
      "kids": {"B": 1, "C": 1},
      "parents": []
    },
    "B": {
      "key": "B",
      "kids": {"D": 1},
      "parents": ["A"]
    },
    "C": {
      "key": "C",
      "kids": {"D": 1},
      "parents": ["A"]
    },
    "D": {
      "key": "D",
      "kids": {},
      "parents": ["B", "C"]
    }
  };
  
  renderDAG(sampleData);
}

function renderDAG(data) {
  // Find root node - a node that is not listed as a kid of another node
  const allNodes = new Set(Object.keys(data));
  for (let nodeName in data) {
    for (let kid in data[nodeName].kids) {
      allNodes.delete(kid);
    }
  }
  const root = allNodes.size > 0 ? Array.from(allNodes)[0] : Object.keys(data)[0];
  
  // Call the RenderSvgFromDag function from render_svg.js with the data directly
  RenderSvgFromDag(data, root);
}
</script>

</body>
</html>