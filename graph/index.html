<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DAG Viewer (Dark Characters)</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="controls">
  <input type="file" id="fileInput" accept=".json" />
  <button id="loadSample">Load Sample Data</button>
</div>

<div id="main-content"></div>

<script src="analyze_graph.js"></script>
<script src="render_svg.js"></script>
<script>
document.getElementById("fileInput").addEventListener("change", handleFile);
document.getElementById("loadSample").addEventListener("click", loadSampleData);

function handleFile(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = e => {
    const json = JSON.parse(e.target.result);
    renderDAG(json);
  };
  reader.readAsText(file);
}

function loadSampleData() {
  // Sample DAG data for demonstration
  const sampleData = {
    "A": {
      "key": "A",
      "parents": [],
      "kids": {"B": 1, "C": 1}
    },
    "B": {
      "key": "B",
      "parents": ["A"],
      "kids": {"D": 1}
    },
    "C": {
      "key": "C",
      "parents": ["A"],
      "kids": {"D": 1}
    },
    "D": {
      "key": "D",
      "parents": ["B", "C"],
      "kids": {}
    }
  };
  
  renderDAG(sampleData);
}

function renderDAG(data) {
  // Find root node
  const allNodes = new Set(Object.keys(data));
  for (let nodeName in data) {
    (data[nodeName].parents || []).forEach(parent => {
      allNodes.delete(parent);
    });
  }
  const root = allNodes.size > 0 ? Array.from(allNodes)[0] : Object.keys(data)[0];
  
  // Process the data to match the format expected by render_svg.js
  const processedData = {};
  for (let key in data) {
    const node = data[key];
    processedData[key] = {
      key: node.key,
      kids: {},
      parents: node.parents || []
    };
    
    // Build kids relationship from other nodes' parents
    for (let otherKey in data) {
      if (data[otherKey].parents && data[otherKey].parents.includes(key)) {
        processedData[key].kids[otherKey] = 1;
      }
    }
  }
  
  // Call the RenderSvgFromDag function from render_svg.js
  RenderSvgFromDag(processedData, root);
}
</script>

</body>
</html>